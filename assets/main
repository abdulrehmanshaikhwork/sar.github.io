# --- START AUTO-FIX SCRIPT ---
# Make sure you're on main and have no uncommitted work
git status --porcelain
echo "If there are uncommitted changes, please stash or commit them and re-run."

# create a backup branch
git checkout -b fix/assets-backup

# list image refs in index.html
echo "Image references found in index.html:"
grep -oP 'src="([^"]+)"' index.html | sed 's/src="//' | sed 's/"//' | grep assets || echo "no assets references found"

# show current assets folder listing
echo "Current assets folder listing:"
ls -la assets || echo "No assets directory found. Please unzip portfolio_site/assets into repo root."

# create a lowercase copy of assets filenames (safe approach)
mkdir -p assets_tmp
for f in assets/*; do
  if [ -f "$f" ]; then
    fname=$(basename "$f")
    lfname=$(echo "$fname" | tr '[:upper:]' '[:lower:]')
    cp "$f" "assets_tmp/$lfname"
    echo "copied $fname -> $lfname"
  fi
done

# sanity: show assets_tmp
echo "Lowercased assets_tmp contains:"
ls -la assets_tmp

# Replace assets folder with lowercased copy (this is destructive to originals in working dir)
rm -rf assets
mv assets_tmp assets
echo "Replaced assets/ with lowercased filenames."

# Update index.html references to lowercase for anything under assets/
python3 - <<'PY'
from pathlib import Path
p = Path('index.html')
s = p.read_text()
import re
def lower_asset(match):
    path = match.group(1)
    if path.startswith('assets/'):
        return f'src="{path.lower()}"'
    return match.group(0)
s2 = re.sub(r'src="([^"]+)"', lower_asset, s)
p.write_text(s2)
print("index.html references updated to lowercase for assets/*")
PY

# Commit and push the fix
git add assets index.html
git commit -m "Fix: lowercase asset filenames and update index.html refs (auto-fix)"
git push origin HEAD:main

echo "âœ… Auto-fix committed & pushed to main. Check your GitHub Pages site and hard-refresh (Ctrl+Shift+R)."
# --- END AUTO-FIX SCRIPT ---
